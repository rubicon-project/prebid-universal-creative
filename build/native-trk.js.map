{"version":3,"sources":["webpack:///webpack/bootstrap 33dfa72cb254b4c0a7c0","webpack:///./src/utils.js","webpack:///./src/messaging.js","webpack:///./src/nativeTrackers.js","webpack:///./src/nativeTrackerManager.js","webpack:///./src/domHelper.js","webpack:///./src/nativeAssetManager.js"],"names":["triggerPixel","url","done","img","Image","addEventListener","src","createTrackPixelHtml","escapedUrl","encodeURI","writeAdUrl","adUrl","width","height","iframe","domHelper","document","body","appendChild","sendRequest","callback","reqListener","oReq","responseText","XMLHttpRequest","open","send","getUUID","d","Date","getTime","uuid","replace","c","r","Math","random","floor","toString","loadScript","currentWindow","tagSrc","successCallback","errorCallback","doc","scriptTag","createElement","type","readyState","onreadystatechange","onload","onerror","elToAppend","getElementsByTagName","length","insertBefore","firstChild","getCreativeComment","bid","createComment","crid","getCreativeCommentMarkup","creativeComment","wrapper","innerHTML","transformAuctionTargetingData","tagData","auctionKeyMap","hb_adid","hb_cache_host","hb_cache_path","hb_cache_id","hb_format","hb_env","hb_size","hb_pb","isMacroPresent","paramName","isPlainObject","Object","keys","isStr","convertTargetingMapToNormalMap","tarMap","newTarMap","forEach","key","Array","isArray","convertKeyPairStringToMap","keywordsStr","keywordsMap","keywordsArr","split","keyPairStr","keyPairArr","k","v","renameKnownAuctionKeys","adServerKeyMap","internalKey","auctionData","formattedKeyMap","targetingMap","targetingKeywords","parseUrl","parsed","href","decodeURIComponent","protocol","hostname","port","pathname","hash","host","window","location","isA","object","_t","prototype","call","prebidMessenger","publisherURL","win","prebidDomain","parsedUrl","sendMessage","message","onResponse","Error","JSON","stringify","messagePort","parent","postMessage","channel","MessageChannel","port1","onmessage","windowListener","port2","stopListening","removeEventListener","ev","origin","originalEvent","pbNativeTag","nativeTrackerManager","newNativeTrackerManager","startTrackers","AD_ANCHOR_CLASS_NAME","AD_DATA_ADID_ATTRIBUTE","findAdElements","className","adElements","getElementsByClassName","readAdIdFromElement","adId","attributes","value","readAdIdFromSingleElement","adElement","loadClickTrackers","event","fireTracker","loadImpTrackers","i","attachClickListeners","listener","action","console","warn","dataObject","targetingData","pubUrl","nativeAssetManager","newNativeAssetManager","env","cb","clickTrackers","impTrackers","loadMobileClickTrackers","boundedLoadMobileClickTrackers","bind","loadMobileAssets","loadAssets","getEmptyIframe","frame","setAttribute","insertElement","elm","target","e","NATIVE_KEYS","title","body2","privacyLink","sponsoredBy","image","icon","clickUrl","displayUrl","cta","rating","address","downloads","likes","phone","price","salePrice","rendererUrl","assetTypeMapping","DEFAULT_CACHE_HOST","DEFAULT_CACHE_PATH","errorCountEscapeHatch","cancelMessageListener","getCacheEndpoint","cacheHost","cachePath","path","parseResponse","response","bidObject","parse","error","log","transformToPrebidKeys","adMarkup","assets","clicktrackers","assetsFromMarkup","asset","push","data","text","link","imptrackers","requestAssetsFromCache","ajaxCallback","bidResponse","adm","markup","newHtml","placeholders","scanForPlaceholders","flag","pbNativeData","hasOwnProperty","assetsToReplace","match","requestAllAssets","requestAssets","placeholderKey","placeholder","placeholderIndex","indexOf","head","replaceAssets","requestHeightResize","ortb","renderAd","clientHeight","offsetHeight","getElementById","adTemplate","template","html","searchString","searchStringRegex","RegExp"],"mappings":"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","file":"native-trk.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 33dfa72cb254b4c0a7c0","import * as domHelper from './domHelper';\n\n/**\n * Inserts an image pixel with the specified `url` for cookie sync\n * @param {string} url URL string of the image pixel to load\n * @param  {function} [done] an optional exit callback, used when this usersync pixel is added during an async process\n */\nexport function triggerPixel(url, done) {\n  const img = new Image();\n  if (done && typeof done === 'function') {\n    img.addEventListener('load', done);\n    img.addEventListener('error', done);\n  }\n  img.src = url;\n}\n\nexport function createTrackPixelHtml(url) {\n  if (!url) {\n    return '';\n  }\n\n  let escapedUrl = encodeURI(url);\n  let img = `<div style=\"position:absolute;left:0px;top:0px;visibility:hidden;\"><img src=\"${escapedUrl}\"></div>`;\n  return img;\n}\n\nexport function writeAdUrl(adUrl, width, height) {\n  let iframe = domHelper.getEmptyIframe(height, width);\n  iframe.src = adUrl;\n  document.body.appendChild(iframe);\n}\n\nexport function sendRequest(url, callback) {\n  function reqListener() {\n    callback(oReq.responseText);\n  }\n\n  let oReq = new XMLHttpRequest();\n  oReq.addEventListener('load', reqListener);\n  oReq.open('GET', url);\n  oReq.send();\n}\n\nexport function getUUID() {\n  let d = new Date().getTime();\n  let uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    let r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n  });\n  return uuid;\n};\n\nexport function loadScript(currentWindow, tagSrc, successCallback, errorCallback) {\n  let doc = currentWindow.document;\n  let scriptTag = doc.createElement('script');\n  scriptTag.type = 'text/javascript';\n\n  // Execute success callback if necessary\n  if (successCallback && typeof successCallback === 'function') {\n    if (scriptTag.readyState) {\n      scriptTag.onreadystatechange = function() {\n        if (scriptTag.readyState === 'loaded' || scriptTag.readyState === 'complete') {\n          scriptTag.onreadystatechange = null;\n          successCallback();\n        }\n      };\n    } else {\n      scriptTag.onload = function() {\n        successCallback();\n      };\n    }\n  }\n\n  // Execute error callback if necessary\n  if (errorCallback && typeof errorCallback === 'function') {\n    scriptTag.onerror = function() {\n      errorCallback();\n    };\n  }\n\n  scriptTag.src = tagSrc;\n\n  //add the new script tag to the page\n  let elToAppend = doc.getElementsByTagName('head');\n  elToAppend = elToAppend.length ? elToAppend : doc.getElementsByTagName('body');\n  if (elToAppend.length) {\n    elToAppend = elToAppend[0];\n    elToAppend.insertBefore(scriptTag, elToAppend.firstChild);\n  }\n\n  return scriptTag;\n};\n\n/**\n * Return comment element\n * @param {*} bid\n */\nexport function getCreativeComment(bid) {\n  return document.createComment(`Creative ${bid.crid} served by Prebid.js Header Bidding`);\n}\n\n/**\n * Returns comment element markup\n * @param {*} bid\n */\nexport function getCreativeCommentMarkup(bid) {\n  let creativeComment = getCreativeComment(bid);\n  let wrapper = document.createElement('div');\n  wrapper.appendChild(creativeComment);\n  return wrapper.innerHTML;\n}\n\nexport function transformAuctionTargetingData(tagData) {\n  // this map object translates the Prebid.js auction keys to their equivalent Prebid Universal Creative keys\n  // when the publisher uses their adserver's generic macro that provides all targeting keys (ie tagData.targetingMap), we need to convert the keys\n  const auctionKeyMap = {\n    hb_adid: 'adId',\n    hb_cache_host: 'cacheHost',\n    hb_cache_path: 'cachePath',\n    hb_cache_id: 'uuid',\n    hb_format: 'mediaType',\n    hb_env: 'env',\n    hb_size: 'size',\n    hb_pb: 'hbPb'\n  };\n\n  /**\n   * Determine if the supplied property of the tagData object exists and is populated with its own values/properties according to its type\n   * @param {string} paramName name of the property to check (eg tagData.targetingMap)\n   * @returns true/false\n   */\n  function isMacroPresent(paramName) {\n    return !!(\n      tagData[paramName] && (\n        (isPlainObject(tagData[paramName]) && Object.keys(tagData[paramName]).length > 0) ||\n        (isStr(tagData[paramName]) && tagData[paramName] !== '')\n      )\n    );\n  }\n\n  /**\n   * Converts the specifically formatted object of keypairs to a more generalized structure\n   * It specifically extracts the keyvalue from an array and stores it as a normal string\n   * @param {object} tarMap object of keys with the keyvalue stored in an array; eg {\"hb_adid\":[\"26566ee8c7f251\"], ...}\n   * @returns {object} result is an object map like the following: {\"hb_cache_id\":\"123456\", \"other_key\":\"other_value\", ...}\n   */\n  function convertTargetingMapToNormalMap(tarMap) {\n    let newTarMap = {};\n\n    Object.keys(tarMap).forEach(function(key) {\n      if (Array.isArray(tarMap[key]) && tarMap[key].length > 0) {\n        newTarMap[key] = tarMap[key][0];\n      }\n    });\n    return newTarMap;\n  }\n\n  /**\n   * Converts a specifically formatted string of keypairs to a specifically formatted object map\n   * @param {String} keywordsStr string of keypairs; eg \"hb_cache_id:123456,other_key:other_value\"\n   * @returns {object} result is an object map like the following: {\"hb_cache_id\":\"123456\", \"other_key\":\"other_value\", ...}\n   */\n  function convertKeyPairStringToMap(keywordsStr) {\n    let keywordsMap = {};\n    const keywordsArr = keywordsStr.split(',');\n\n    if (keywordsArr.length > 0) {\n      keywordsArr.forEach(function(keyPairStr) {\n        let keyPairArr = keyPairStr.split(':');\n        if (keyPairArr.length === 2) {\n          let k = keyPairArr[0];\n          let v = keyPairArr[1];\n          keywordsMap[k] = v;\n        }\n      });\n    }\n    return keywordsMap;\n  }\n\n  /**\n   * Rename key if it's part of the auctionKeyMap object; if not, leave key as is\n   * Store the resultant keypair in the auctionData object for later use in renderingManager.renderAd()\n   * @param {object} adServerKeyMap incoming object map of the auction keys from the UC tag; eg {'key1':'value1', 'key2':'value2', ...}\n   */\n  function renameKnownAuctionKeys(adServerKeyMap) {\n    Object.keys(adServerKeyMap).forEach(function(key) {\n      let internalKey = auctionKeyMap[key] || key;\n      auctionData[internalKey] = adServerKeyMap[key];\n    });\n  }\n\n  let auctionData = {};\n  let formattedKeyMap = {};\n\n  if (isMacroPresent('targetingMap')) {\n    formattedKeyMap = convertTargetingMapToNormalMap(tagData.targetingMap);\n  } else if (isMacroPresent('targetingKeywords')) {\n    formattedKeyMap = convertKeyPairStringToMap(tagData.targetingKeywords);\n  }\n  renameKnownAuctionKeys(formattedKeyMap);\n\n  // set keys not in defined map macros (eg targetingMap) and/or the keys setup within a non-DFP adserver\n  Object.keys(tagData).forEach(function (key) {\n    if (key !== 'targetingMap' && key !== 'targetingKeywords' && isStr(tagData[key]) && tagData[key] !== '') {\n      auctionData[key] = tagData[key];\n    }\n  });\n  return auctionData;\n}\n\nexport function parseUrl(url) {\n  let parsed = document.createElement('a');\n\n  parsed.href = decodeURIComponent(url);\n\n  return {\n    href: parsed.href,\n    protocol: (parsed.protocol || '').replace(/:$/, ''),\n    hostname: parsed.hostname,\n    port: +parsed.port,\n    pathname: parsed.pathname.replace(/^(?!\\/)/, '/'),\n    hash: (parsed.hash || '').replace(/^#/, ''),\n    host: (parsed.host || window.location.host).replace(/:(443|80)$/, '')\n  };\n}\n\nfunction isA(object, _t) {\n  return Object.prototype.toString.call(object) === '[object ' + _t + ']';\n};\n\nfunction isPlainObject(object) {\n  return isA(object, 'Object');\n}\n\nfunction isStr(object) {\n  return isA(object, 'String');\n};\n\n\n\n// WEBPACK FOOTER //\n// ./src/utils.js","import {parseUrl} from './utils.js';\n\nexport function prebidMessenger(publisherURL, win = window) {\n    const prebidDomain = (() => {\n        if (publisherURL == null) {\n            return null;\n        }\n        const parsedUrl = parseUrl(publisherURL);\n        return parsedUrl.protocol + '://' + parsedUrl.host;\n    })();\n\n    return function sendMessage(message, onResponse) {\n        if (prebidDomain == null) {\n            throw new Error('Missing pubUrl')\n        }\n        message = JSON.stringify(message);\n        let messagePort;\n        if (onResponse == null) {\n            win.parent.postMessage(message, prebidDomain);\n        } else {\n            const channel = new MessageChannel();\n            messagePort = channel.port1;\n            messagePort.onmessage = onResponse;\n            win.addEventListener('message', windowListener);\n            win.parent.postMessage(message, prebidDomain, [channel.port2]);\n        }\n\n        return function stopListening() {\n            if (messagePort != null) {\n                win.removeEventListener('message', windowListener);\n                messagePort.onmessage = null;\n                messagePort = null;\n            }\n        }\n\n        function windowListener(ev) {\n            if ((ev.origin || (ev.originalEvent && ev.originalEvent.origin)) === prebidDomain) {\n                onResponse(ev);\n            }\n        }\n\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/messaging.js","import { newNativeTrackerManager } from './nativeTrackerManager';\n\nwindow.pbNativeTag = (window.pbNativeTag || {});\nconst nativeTrackerManager = newNativeTrackerManager(window);\n\nwindow.pbNativeTag.startTrackers = nativeTrackerManager.startTrackers;\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/nativeTrackers.js","/*\n * Script to handle firing impression and click trackers from native teamplates\n */\nimport { parseUrl, triggerPixel, transformAuctionTargetingData } from './utils';\nimport { newNativeAssetManager } from './nativeAssetManager';\nimport {prebidMessenger} from './messaging.js';\n\nconst AD_ANCHOR_CLASS_NAME = 'pb-click';\nconst AD_DATA_ADID_ATTRIBUTE = 'pbAdId';\n\nexport function newNativeTrackerManager(win) {\n  let sendMessage;\n\n  function findAdElements(className) {\n    let adElements = win.document.getElementsByClassName(className);\n    return adElements || [];\n  }\n\n  function readAdIdFromElement(adElements) {\n    let adId = (adElements.length > 0) &&\n      adElements[0].attributes &&\n      adElements[0].attributes[AD_DATA_ADID_ATTRIBUTE] &&\n      adElements[0].attributes[AD_DATA_ADID_ATTRIBUTE].value;\n    return adId || '';\n  }\n\n  function readAdIdFromSingleElement(adElement) {\n    let adId =  adElement.attributes &&\n      adElement.attributes[AD_DATA_ADID_ATTRIBUTE] &&\n      adElement.attributes[AD_DATA_ADID_ATTRIBUTE].value;\n    return adId || '';\n  }\n\n  function loadClickTrackers(event, adId) {\n    fireTracker(adId, 'click');\n  }\n\n  function loadImpTrackers(adElements) {\n      for(var i = 0; i < adElements.length; i++){\n          let adId = readAdIdFromSingleElement(adElements[i]);\n          fireTracker(adId, 'impression');\n      }\n  }\n\n  function attachClickListeners(adElements, listener = loadClickTrackers) {\n    adElements = adElements || findAdElements(AD_ANCHOR_CLASS_NAME);\n\n    for (let i = 0; i < adElements.length; i++) {\n      let adId = readAdIdFromSingleElement(adElements[i]);\n      adElements[i].addEventListener('click', function(event) {\n        listener(event, adId);\n      }, true);\n    }\n  }\n\n  function fireTracker(adId, action) {\n    if (adId === '') {\n      console.warn('Prebid tracking event was missing \\'adId\\'.  Was adId macro set in the HTML attribute ' + AD_DATA_ADID_ATTRIBUTE + 'on the ad\\'s anchor element');\n    } else {\n      let message = { message: 'Prebid Native', adId: adId };\n\n      // fires click trackers when called via link\n      if (action === 'click') {\n        message.action = 'click';\n      }\n\n      sendMessage(message);\n    }\n  }\n\n  // START OF MAIN CODE\n  let startTrackers = function (dataObject) {\n    const targetingData = transformAuctionTargetingData(dataObject);\n    sendMessage = prebidMessenger(targetingData.pubUrl, win);\n    const nativeAssetManager = newNativeAssetManager(window, targetingData.pubUrl);\n\n    if (targetingData && targetingData.env === 'mobile-app') {\n      let cb = function({clickTrackers, impTrackers} = {}) {\n        function loadMobileClickTrackers(clickTrackers) {\n          (clickTrackers || []).forEach(triggerPixel);\n        }\n        const boundedLoadMobileClickTrackers = loadMobileClickTrackers.bind(null, clickTrackers);\n        attachClickListeners(false, boundedLoadMobileClickTrackers);\n\n        (impTrackers || []).forEach(triggerPixel);\n      }\n      nativeAssetManager.loadMobileAssets(targetingData, cb);\n    } else {\n      let adElements = findAdElements(AD_ANCHOR_CLASS_NAME);\n\n      nativeAssetManager.loadAssets(\n        readAdIdFromElement(adElements),\n        attachClickListeners\n      );\n\n      attachClickListeners(adElements, loadClickTrackers);\n\n      // fires native impressions on creative load\n      if (adElements.length > 0) {\n        loadImpTrackers(adElements);\n      }\n    }\n  }\n\n  return {\n    startTrackers\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nativeTrackerManager.js","/**\n * domHelper: a collection of helpful dom things\n */\n\n\n/**\n * returns a empty iframe element with specified height/width\n * @param {Number} height height iframe set to \n * @param {Number} width width iframe set to\n * @returns {Element} iframe DOM element \n */\nexport function getEmptyIframe(height, width) {\n    let frame = document.createElement('iframe');\n    frame.setAttribute('frameborder', 0);\n    frame.setAttribute('scrolling', 'no');\n    frame.setAttribute('marginheight', 0);\n    frame.setAttribute('marginwidth', 0);\n    frame.setAttribute('TOPMARGIN', 0);\n    frame.setAttribute('LEFTMARGIN', 0);\n    frame.setAttribute('allowtransparency', 'true');\n    frame.setAttribute('width', width);\n    frame.setAttribute('height', height);\n    return frame;\n  }\n\n  /**\n * Insert element to passed target\n * @param {object} elm\n * @param {object} doc\n * @param {string} target\n */\nexport function insertElement(elm, doc, target) {\n    doc = doc || document;\n    let elToAppend;\n    if (target) {\n      elToAppend = doc.getElementsByTagName(target);\n    } else {\n      elToAppend = doc.getElementsByTagName('head');\n    }\n    try {\n      elToAppend = elToAppend.length ? elToAppend : doc.getElementsByTagName('body');\n      if (elToAppend.length) {\n        elToAppend = elToAppend[0];\n        elToAppend.insertBefore(elm, elToAppend.firstChild);\n      }\n    } catch (e) {}\n  }\n\n\n// WEBPACK FOOTER //\n// ./src/domHelper.js","/**\n * Handles postMessage requests and responses for replacing native placeholder\n * values in native creative templates.\n */\n\nimport { sendRequest, loadScript } from './utils';\nimport {prebidMessenger} from './messaging.js';\n\n/*\n * Native asset->key mapping from Prebid.js/src/constants.json\n * https://github.com/prebid/Prebid.js/blob/8635c91942de9df4ec236672c39b19448545a812/src/constants.json#L67\n */\nconst NATIVE_KEYS = {\n  title: 'hb_native_title',\n  body: 'hb_native_body',\n  body2: 'hb_native_body2',\n  privacyLink: 'hb_native_privacy',\n  sponsoredBy: 'hb_native_brand',\n  image: 'hb_native_image',\n  icon: 'hb_native_icon',\n  clickUrl: 'hb_native_linkurl',\n  displayUrl: 'hb_native_displayurl',\n  cta: 'hb_native_cta',\n  rating: 'hb_native_rating',\n  address: 'hb_native_address',\n  downloads: 'hb_native_downloads',\n  likes: 'hb_native_likes',\n  phone: 'hb_native_phone',\n  price: 'hb_native_price',\n  salePrice: 'hb_native_saleprice',\n  rendererUrl: 'hb_renderer_url',\n};\n\n// Asset type mapping as per Native IAB spec 1.2\n// https://www.iab.com/wp-content/uploads/2017/04/OpenRTB-Native-Ads-Specification-Draft_1.2_2017-04.pdf#page=40\nconst assetTypeMapping = {\n  'image': {\n    1: 'icon',\n    3: 'image'\n  },\n  'data': {\n    1: 'sponsoredBy',\n    2: 'body',\n    3: 'rating',\n    4: 'likes',\n    5: 'downloads',\n    6: 'price',\n    7: 'salePrice',\n    8: 'phone',\n    9: 'address',\n    10: 'body2',\n    11: 'displayUrl',\n    12: 'cta',\n  }\n}\n\nconst DEFAULT_CACHE_HOST = 'prebid.adnxs.com';\nconst DEFAULT_CACHE_PATH = '/pbc/v1/cache';\n\nexport function newNativeAssetManager(win, pubUrl) {\n  const sendMessage = prebidMessenger(pubUrl, win);\n  let callback;\n  let errorCountEscapeHatch = 0;\n  let cancelMessageListener;\n\n  function stopListening() {\n    if (cancelMessageListener != null) {\n      cancelMessageListener();\n      cancelMessageListener = null;\n    }\n  }\n\n\n\n  function getCacheEndpoint(cacheHost, cachePath) {\n    let host = (typeof cacheHost === 'undefined' || cacheHost === \"\") ? DEFAULT_CACHE_HOST : cacheHost;\n    let path = (typeof cachePath === 'undefined' || cachePath === \"\") ? DEFAULT_CACHE_PATH : cachePath;\n\n    return `https://${host}${path}`;\n  }\n\n  function parseResponse(response) {\n    let bidObject;\n    try {\n      bidObject = JSON.parse(response);\n    } catch (error) {\n      console.log(`Error parsing response from cache host: ${error}`);\n    }\n    return bidObject;\n  }\n\n  function transformToPrebidKeys(adMarkup) {\n    let assets = [];\n    let clicktrackers;\n    let assetsFromMarkup = adMarkup.assets;\n    assetsFromMarkup.forEach((asset) => {\n      if (asset.img) {\n        if (assetTypeMapping['image'][asset.img.type]) {\n          assets.push({\n            'key' : assetTypeMapping['image'][asset.img.type],\n            'value' : asset.img.url\n          })\n        } else {\n          console.log('ERROR: Invalid image type for image asset');\n        }\n      } else if (asset.data) {\n        if (assetTypeMapping['data'][asset.data.type]) {\n          assets.push({\n            'key' : assetTypeMapping['data'][asset.data.type],\n            'value' : asset.data.value\n          })\n        } else {\n          console.log('ERROR: Invalid data type for data asset');\n        }\n      } else if (asset.title) {\n        assets.push({\n          'key' : 'title',\n          'value' : asset.title.text\n        })\n      }\n    })\n\n    if (adMarkup.link) {\n      if (adMarkup.link.clicktrackers) {\n        clicktrackers = adMarkup.link.clicktrackers;\n      }\n      assets.push({\n        'key' : 'clickUrl',\n        'value' : adMarkup.link.url\n      })\n    }\n\n    return {\n      assets,\n      clicktrackers,\n      'imptrackers' : adMarkup.imptrackers\n    }\n  }\n\n  function requestAssetsFromCache(tagData) {\n    let ajaxCallback = function(response) {\n      let bidResponse = parseResponse(response);\n      if (bidResponse && bidResponse.adm) {\n        let markup = parseResponse(bidResponse.adm);\n        if (markup && markup.assets) {\n          let data = transformToPrebidKeys(markup);\n          const body = win.document.body.innerHTML;\n          const newHtml = replace(body, data);\n          win.document.body.innerHTML = newHtml;\n\n          callback && callback({\n            clickTrackers: data.clicktrackers,\n            impTrackers: data.imptrackers\n          });\n        } else {\n          // TODO Shall we just write the markup in the page\n        }\n      }\n    }\n    let uuid = tagData.uuid;\n    let adUrl = `${getCacheEndpoint(tagData.cacheHost, tagData.cachePath)}?uuid=${uuid}`;\n    sendRequest(adUrl, ajaxCallback);\n  }\n\n  function loadMobileAssets(tagData, cb) {\n    const placeholders = scanForPlaceholders();\n    if (placeholders.length > 0) {\n      callback = cb;\n      requestAssetsFromCache(tagData);\n    }\n  }\n\n  /*\n   * Entry point to search for placeholderes and set up postmessage roundtrip\n   * to retrieve native assets. Looks for placeholders for the given adId and\n   * fires a callback after the native html is updated. If no placeholders found\n   * and requestAllAssets flag is set in the tag, postmessage roundtrip\n   * to retrieve native assets that have a value on the corresponding bid\n   */\n  function loadAssets(adId, cb) {\n    const placeholders = scanForPlaceholders(adId), flag = (typeof win.pbNativeData !== 'undefined');\n\n    if (flag && win.pbNativeData.hasOwnProperty('assetsToReplace')) {\n        win.pbNativeData.assetsToReplace.forEach((asset) => {\n          const key = (asset.match(/hb_native_/i)) ? asset : NATIVE_KEYS[asset];\n          if (key) {placeholders.push(key);}\n        });\n    }\n\n    if (flag && win.pbNativeData.hasOwnProperty('requestAllAssets') && win.pbNativeData.requestAllAssets) {\n      callback = cb;\n      cancelMessageListener = requestAllAssets(adId);\n    } else if (placeholders.length > 0) {\n      callback = cb;\n      cancelMessageListener = requestAssets(adId, placeholders);\n    }\n  }\n\n  /*\n   * Searches the DOM for placeholder values sent in by Prebid Native\n   */\n  function scanForPlaceholders(adId) {\n    let placeholders = [];\n    const doc = win.document;\n    const flag = (typeof win.pbNativeData !== 'undefined');\n\n    Object.keys(NATIVE_KEYS).forEach(key => {\n      const placeholderKey = NATIVE_KEYS[key];\n      const placeholder = (adId && !flag) ? `${placeholderKey}:${adId}` : `${placeholderKey}`;\n      const placeholderIndex = (~doc.body.innerHTML.indexOf(placeholder)) ? doc.body.innerHTML.indexOf(placeholder) : (doc.head.innerHTML && doc.head.innerHTML.indexOf(placeholder));\n\n      if (~placeholderIndex) {\n        placeholders.push(placeholderKey);\n      }\n    });\n\n    return placeholders;\n  }\n\n  /*\n   * Sends postmessage to Prebid for asset placeholders found in the native\n   * creative template, and setups up a listener for when Prebid responds.\n   */\n  function requestAssets(adId, assets) {\n    const message = {\n      message: 'Prebid Native',\n      action: 'assetRequest',\n      adId,\n      assets,\n    };\n\n    return sendMessage(message, replaceAssets);\n  }\n\n  /*\n   * Sends postmessage to Prebid for asset placeholders found in the native\n   * creative template, and setups up a listener for when Prebid responds.\n   */\n  function requestAllAssets(adId) {\n    const message = {\n      message: 'Prebid Native',\n      action: 'allAssetRequest',\n      adId,\n    };\n    return sendMessage(message, replaceAssets);\n  }\n\n  /*\n   * Sends postmessage to Prebid for native resize\n   */\n  function requestHeightResize(adId, height) {\n    const message = {\n      message: 'Prebid Native',\n      action: 'resizeNativeHeight',\n      adId,\n      height,\n    };\n    sendMessage(message);\n  }\n\n  /*\n   * Postmessage listener for when Prebid responds with requested native assets.\n   */\n  function replaceAssets(event) {\n    var data = {};\n\n    try {\n      data = JSON.parse(event.data);\n    } catch (e) {\n      if (errorCountEscapeHatch++ > 10) {\n        /*\n         * if for some reason Prebid never responds with the native assets,\n         * get rid of this listener because other messages won't stop coming\n         */\n        stopListening();\n      }\n      return;\n    }\n\n    if (data.message === 'assetResponse') {\n      const body = win.document.body.innerHTML;\n      const head = win.document.head.innerHTML;\n      const flag = (typeof win.pbNativeData !== 'undefined');\n\n      if (flag && data.adId !== win.pbNativeData.adId) return;\n\n      if (head) win.document.head.innerHTML = replace(head, data);\n\n      const assets = data.assets || data.ortb;\n      if ((data.hasOwnProperty('rendererUrl') && data.rendererUrl) || (flag && win.pbNativeData.hasOwnProperty('rendererUrl'))) {\n        if (win.renderAd) {\n          const newHtml = (win.renderAd && win.renderAd(assets)) || '';\n\n          win.document.body.innerHTML = body + newHtml;\n          callback && callback();\n          stopListening();\n          requestHeightResize(data.adId, (document.body.clientHeight || document.body.offsetHeight));\n        } else if (document.getElementById('pb-native-renderer')) {\n          document.getElementById('pb-native-renderer').addEventListener('load', function() {\n            const newHtml = (win.renderAd && win.renderAd(assets)) || '';\n\n            win.document.body.innerHTML = body + newHtml;\n            callback && callback();\n            stopListening();\n            requestHeightResize(data.adId, (document.body.clientHeight || document.body.offsetHeight));\n          });\n        } else {\n          loadScript(win, ((flag && win.pbNativeData.hasOwnProperty('rendererUrl') && win.pbNativeData.rendererUrl) || data.rendererUrl), function() {\n            const newHtml = (win.renderAd && win.renderAd(assets)) || '';\n\n            win.document.body.innerHTML = body + newHtml;\n            callback && callback();\n            stopListening();\n            requestHeightResize(data.adId, (document.body.clientHeight || document.body.offsetHeight));\n          })\n        }\n      } else if ((data.hasOwnProperty('adTemplate') && data.adTemplate)||(flag && win.pbNativeData.hasOwnProperty('adTemplate'))) {\n        const template =  (flag && win.pbNativeData.hasOwnProperty('adTemplate') && win.pbNativeData.adTemplate) || data.adTemplate;\n        const newHtml = replace(template, data);\n        win.document.body.innerHTML = body + newHtml;\n        callback && callback();\n        stopListening();\n        requestHeightResize(data.adId, (document.body.clientHeight || document.body.offsetHeight));\n      } else {\n        const newHtml = replace(body, data);\n\n        win.document.body.innerHTML = newHtml;\n        callback && callback();\n        stopListening();\n      }\n    }\n  }\n\n  /**\n   * Replaces occurrences of native placeholder values with their actual values\n   * in the given document.\n   */\n  function replace(document, { assets, adId }) {\n    let html = document;\n\n    (assets || []).forEach(asset => {\n      const flag = (typeof win.pbNativeData !== 'undefined');\n      const searchString = (adId && !flag) ? `${NATIVE_KEYS[asset.key]}:${adId}` : ((flag) ? '##'+`${NATIVE_KEYS[asset.key]}`+'##' : `${NATIVE_KEYS[asset.key]}`);\n      const searchStringRegex = new RegExp(searchString, 'g');\n      html = html.replace(searchStringRegex, asset.value);\n    });\n\n    return html;\n  }\n\n  return {\n    loadAssets,\n    loadMobileAssets\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/nativeAssetManager.js"],"sourceRoot":""}